<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artik Food ‚Äî –î–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ê—Ä—Ç–∏–∫–µ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    header {
      background: #2ecc71;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 24px;
    }
    .store-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 15px;
    }
    .store {
      background: white;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      flex: 1 1 calc(33.333% - 20px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .store img {
      width: 50px;
      height: 50px;
      margin-bottom: 10px;
    }
    .cart {
      position: fixed;
      bottom: 0;
      right: 0;
      background: white;
      padding: 15px;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 300px;
      z-index: 1000;
    }
    .cart.hidden {
      display: none;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .cart-total {
      font-weight: bold;
      margin-top: 10px;
    }
    .order-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 15px;
      background: white;
      margin-bottom: 100px;
    }
    .order-form input {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .order-form button {
      background: #2ecc71;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .admin-panel {
      display: none;
      padding: 15px;
      background: white;
      margin-bottom: 100px;
    }
    .admin-panel.hidden {
      display: none;
    }
    .admin-card {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }
    .admin-table th, .admin-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>

<header>
  <h1>Artik Food</h1>
</header>

<!-- –ú–∞–≥–∞–∑–∏–Ω—ã -->
<div class="store-list" id="store-list"></div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div class="cart hidden" id="global-cart">
  <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
  <div id="cart-items"></div>
  <div class="cart-total">–ò—Ç–æ–≥–æ: <span id="cart-total">0</span> AMD</div>
  <button onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
<form id="order-form" class="order-form hidden" onsubmit="event.preventDefault(); sendFormToWhatsApp();">
  <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
  <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required>
  <input type="tel" id="phone" placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω" required>
  <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required>
  <select id="district" required>
    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω</option>
    <option value="–¶–µ–Ω—Ç—Ä">–¶–µ–Ω—Ç—Ä</option>
    <option value="–°–µ–≤–µ—Ä">–°–µ–≤–µ—Ä</option>
    <option value="–Æ–≥">–Æ–≥</option>
  </select>
  <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
</form>

<!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
<div id="admin-panel" class="admin-panel hidden">
  <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
  <div class="admin-card">
    <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å</h4>
    <p>–ó–∞–∫–∞–∑–æ–≤: <span id="today-orders">0</span></p>
    <p>–°—É–º–º–∞: <span id="today-amount">0</span> AMD</p>
    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤: <span id="active-couriers">0</span></p>
  </div>
  <div class="admin-card">
    <h4>üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</h4>
    <select id="order-filter" onchange="filterOrders()">
      <option value="–í—Å–µ">–í—Å–µ</option>
      <option value="–ù–æ–≤—ã–π">–ù–æ–≤—ã–µ</option>
      <option value="–í –æ–±—Ä–∞–±–æ—Ç–∫–µ">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
      <option value="–î–æ—Å—Ç–∞–≤–ª–µ–Ω">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ</option>
    </select>
    <div id="all-orders-list"></div>
  </div>
  <div class="admin-card">
    <h4>üìã –ò—Å—Ç–æ—Ä–∏—è –∫—É—Ä—å–µ—Ä–æ–≤</h4>
    <table class="admin-table">
      <tr>
        <th>–ö—É—Ä—å–µ—Ä</th>
        <th>–ó–∞–∫–∞–∑–æ–≤</th>
        <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</th>
      </tr>
      <tbody id="couriers-history"></tbody>
    </table>
  </div>
  <div class="admin-card">
    <h4>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h4>
    <button onclick="addCourier()">–î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞</button>
    <button onclick="exportToCSV()">–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤</button>
    <button onclick="hideAdminPanel()">–ó–∞–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω–∫—É</button>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
<button id="admin-login-btn" onclick="loginAdmin()">–í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É</button>

<script>
/* --------------- –û–°–ù–û–í–ù–´–ï –î–ê–ù–ù–´–ï --------------- */
const ADMIN_PASSWORD = "artik123";
let orders = JSON.parse(localStorage.getItem('artikFoodOrders')) || [];
let couriers = JSON.parse(localStorage.getItem('artikFoodCouriers')) || [];
let nextCourierId = couriers.length > 0 ? Math.max(...couriers.map(c => c.id)) + 1 : 1;

const stores = {
  tonoyan: {
    name: "Tonoyan City",
    logo: "logo-tonoyan.png",
    categories: {
      bakery: {
        name: "–í—ã–ø–µ—á–∫–∞",
        products: {
          bread: { name: "–•–ª–µ–±", price: 300 },
          cake: { name: "–¢–æ—Ä—Ç", price: 1500 }
        }
      }
      // –î—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã
    }
  }
  // –î—Ä—É–≥–∏–µ –º–∞–≥–∞–∑–∏–Ω—ã
};

/* --------------- –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò --------------- */
function renderShops() {
  const container = document.getElementById('store-list');
  container.innerHTML = '';
  for (const key in stores) {
    const div = document.createElement('div');
    div.className = 'store';
    div.innerHTML = stores[key].logo ?
      `<img src="${stores[key].logo}" alt="${stores[key].name}"><div>${stores[key].name}</div>` :
      stores[key].name;
    div.onclick = () => openStore(key);
    container.appendChild(div);
  }
}

function openStore(storeKey) {
  const store = stores[storeKey];
  document.getElementById('store-list').innerHTML = `
    <div class="store" onclick="renderShops()">‚Üê –ù–∞–∑–∞–¥</div>
    <h2>${store.name}</h2>
  `;
  for (const categoryKey in store.categories) {
    const category = store.categories[categoryKey];
    const div = document.createElement('div');
    div.className = 'store';
    div.innerHTML = category.name;
    div.onclick = () => openStoreCategory(storeKey, categoryKey);
    document.getElementById('store-list').appendChild(div);
  }
}

function openStoreCategory(storeKey, categoryKey) {
  const category = stores[storeKey].categories[categoryKey];
  document.getElementById('store-list').innerHTML = `
    <div class="store" onclick="openStore('${storeKey}')">‚Üê –ù–∞–∑–∞–¥</div>
    <h2>${category.name}</h2>
  `;
  for (const productKey in category.products) {
    const product = category.products[productKey];
    const div = document.createElement('div');
    div.className = 'store';
    div.innerHTML = `
      <div>${product.name}</div>
      <div>${product.price} AMD</div>
      <button onclick="changeQty('${storeKey}', '${categoryKey}', '${productKey}', 1)">+</button>
      <button onclick="changeQty('${storeKey}', '${categoryKey}', '${productKey}', -1)">-</button>
    `;
    document.getElementById('store-list').appendChild(div);
  }
}

function changeQty(storeKey, categoryKey, productKey, delta) {
  const cart = JSON.parse(localStorage.getItem('cart')) || {};
  if (!cart[storeKey]) cart[storeKey] = {};
  if (!cart[storeKey][categoryKey]) cart[storeKey][categoryKey] = {};
  if (!cart[storeKey][categoryKey][productKey]) cart[storeKey][categoryKey][productKey] = 0;
  cart[storeKey][categoryKey][productKey] += delta;
  if (cart[storeKey][categoryKey][productKey] <= 0) {
    delete cart[storeKey][categoryKey][productKey];
  }
  localStorage.setItem('cart', JSON.stringify(cart));
  renderGlobalCart();
}

function renderGlobalCart() {
  const cart = JSON.parse(localStorage.getItem('cart')) || {};
  const container = document.getElementById('cart-items');
  let total = 0;
  container.innerHTML = '';
  for (const storeKey in cart) {
    for (const categoryKey in cart[storeKey]) {
      for (const productKey in cart[storeKey][categoryKey]) {
        const product = stores[storeKey].categories[categoryKey].products[productKey];
        const qty = cart[storeKey][categoryKey][productKey];
        total += product.price * qty;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div>${product.name}</div>
          <div>${qty} x ${product.price} AMD</div>
        `;
        container.appendChild(div);
      }
    }
  }
  document.getElementById('cart-total').textContent = total;
  document.getElementById('global-cart').classList.toggle('hidden', total === 0);
}

function checkout() {
  document.getElementById('order-form').classList.remove('hidden');
}

function sendFormToWhatsApp() {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const address = document.getElementById('address').value;
  const district = document.getElementById('district').value;
  const cart = JSON.parse(localStorage.getItem('cart')) || {};
  let message = `–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:
–ò–º—è: ${name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
–ê–¥—Ä–µ—Å: ${address}
–†–∞–π–æ–Ω: ${district}

–¢–æ–≤–∞—Ä—ã:
`;
  let total = 0;
  for (const storeKey in cart) {
    for (const categoryKey in cart[storeKey]) {
      for (const productKey in cart[storeKey][categoryKey]) {
        const product = stores[storeKey].categories[categoryKey].products[productKey];
        const qty = cart[storeKey][categoryKey][productKey];
        message += `${product.name} ‚Äî ${qty} x ${product.price} AMD
`;
        total += product.price * qty;
      }
    }
  }
  message += `
–ò—Ç–æ–≥–æ: ${total} AMD`;
  const whatsappUrl = `https://wa.me/37443797727?text=${encodeURIComponent(message)}`;
  window.open(whatsappUrl, '_blank');
  localStorage.removeItem('cart');
  document.getElementById('order-form').classList.add('hidden');
  renderGlobalCart();
}

/* --------------- –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ --------------- */
function loginAdmin() {
  const password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:");
  if (password === ADMIN_PASSWORD) {
    showAdminPanel();
  } else {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
  }
}

function showAdminPanel() {
  document.getElementById('admin-panel').classList.remove('hidden');
  document.getElementById('admin-login-btn').style.display = 'none';
  updateAdminStats();
}

function hideAdminPanel() {
  document.getElementById('admin-panel').classList.add('hidden');
  document.getElementById('admin-login-btn').style.display = 'block';
}

function updateAdminStats() {
  const today = new Date().toDateString();
  const todayOrders = orders.filter(order => 
    new Date(order.date).toDateString() === today
  );
  
  document.getElementById('today-orders').textContent = todayOrders.length;
  document.getElementById('today-amount').textContent = 
    todayOrders.reduce((sum, order) => sum + order.total, 0);
  document.getElementById('active-couriers').textContent = 
    couriers.filter(c => c.status === 'active').length;
  
  renderOrdersList(orders);
  updateCouriersHistory();
}

function renderOrdersList(ordersList) {
  const container = document.getElementById('all-orders-list');
  container.innerHTML = '';
  
  ordersList.forEach(order => {
    const div = document.createElement('div');
    div.style.padding = '8px';
    div.style.borderBottom = '1px solid #eee';
    div.innerHTML = `
      <strong>${order.name}</strong> ‚Äî ${order.total} AMD (${order.status})<br>
      <small>${order.address} ‚Ä¢ ${order.date}</small>
      ${order.status === "–ù–æ–≤—ã–π" ? renderCourierAssign(order.id) : ""}
    `;
    container.appendChild(div);
  });
  
  if (ordersList.length === 0) {
    container.innerHTML = '<p style="text-align:center; color:#777;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
  }
}

function renderCourierAssign(orderId) {
  const activeCouriers = couriers.filter(c => c.status === 'active');
  let html = `<select id="courier-select-${orderId}">`;
  activeCouriers.forEach(c => {
    html += `<option value="${c.id}">${c.name} (${c.phone})</option>`;
  });
  html += `</select> 
            <button onclick="assignCourier(${orderId}, 
            document.getElementById('courier-select-${orderId}').value)">
            –ù–∞–∑–Ω–∞—á–∏—Ç—å</button>`;
  return html;
}

function assignCourier(orderId, courierId) {
  const order = orders.find(o => o.id === orderId);
  if (order) {
    order.courier = courierId;
    order.status = "–ü–µ—Ä–µ–¥–∞–Ω –∫—É—Ä—å–µ—Ä—É";
    localStorage.setItem('artikFoodOrders', JSON.stringify(orders));
    updateAdminStats();
  }
}

function updateCouriersHistory() {
  const history = couriers.map(c => {
    const courierOrders = orders.filter(o => o.courier === c.id);
    return `
      <tr>
        <td>${c.name}</td>
        <td>${courierOrders.length}</td>
        <td>${courierOrders.length ? courierOrders[0].date : '–ù–µ—Ç'}</td>
      </tr>
    `;
  }).join('');
  document.getElementById('couriers-history').innerHTML = history;
}

function filterOrders() {
  const filter = document.getElementById('order-filter').value;
  const filtered = filter === "–í—Å–µ" ? orders : orders.filter(o => o.status === filter);
  renderOrdersList(filtered);
}

function exportToCSV() {
  const csv = orders.map(o => 
    `${o.id},${o.name},${o.total},${o.status}`
  ).join('
');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'orders.csv';
  a.click();
}

function addCourier() {
  const name = prompt("–ò–º—è –∫—É—Ä—å–µ—Ä–∞:");
  if (!name) return;
  
  const phone = prompt("–¢–µ–ª–µ—Ñ–æ–Ω –∫—É—Ä—å–µ—Ä–∞:");
  if (!phone) return;
  
  const courier = {
    id: nextCourierId++,
    name: name,
    phone: phone,
    status: 'active',
    completedOrders: 0,
    rating: 5.0
  };
  
  couriers.push(courier);
  localStorage.setItem('artikFoodCouriers', JSON.stringify(couriers));
  updateAdminStats();
  alert(`–ö—É—Ä—å–µ—Ä ${name} –¥–æ–±–∞–≤–ª–µ–Ω!`);
}

document.addEventListener('DOMContentLoaded', function() {
  const savedOrders = localStorage.getItem('artikFoodOrders');
  const savedCouriers = localStorage.getItem('artikFoodCouriers');
  
  if (savedOrders) orders = JSON.parse(savedOrders);
  if (savedCouriers) couriers = JSON.parse(savedCouriers);

  renderShops();
  renderGlobalCart();
});
</script>

</body>
</html>
