<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Artik Food ‚Äî Premium Delivery</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f1115">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-main: #0f1115;
      --bg-secondary: #151822;
      --bg-card: rgba(255,255,255,0.06);
      --bg-glass: rgba(255,255,255,0.08);
      --border-glass: rgba(255,255,255,0.12);
      --accent-gold: #d4af37;
      --accent-green: #2ecc71;
      --text-main: #f4f4f4;
      --text-muted: #b3b3b3;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.35);
      --shadow-hover: 0 16px 40px rgba(0,0,0,0.5);
      --radius-xl: 20px;
      --radius-lg: 16px;
      --radius-md: 12px;
    }

    body.light-theme {
      --bg-main: #f7f7f9;
      --bg-secondary: #ffffff;
      --bg-card: rgba(0,0,0,0.04);
      --bg-glass: rgba(0,0,0,0.05);
      --border-glass: rgba(0,0,0,0.12);
      --accent-gold: #b08a1f;
      --accent-green: #27ae60;
      --text-main: #1c1c1e;
      --text-muted: #6e6e73;
      --shadow-soft: 0 8px 24px rgba(0,0,0,0.08);
      --shadow-hover: 0 14px 34px rgba(0,0,0,0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #1b1f2b 0%, #0f1115 50%, #0b0d12 100%);
      color: var(--text-main);
      line-height: 1.5;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.light-theme {
      background: radial-gradient(1200px 600px at 20% -10%, #ffffff 0%, #f2f2f6 50%, #ececf1 100%);
    }

    a { color: var(--accent-gold); text-decoration: none; }
    a:hover { text-decoration: underline; }

    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: linear-gradient(180deg, rgba(15,17,21,0.95), rgba(15,17,21,0.85));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-glass);
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    body.light-theme header {
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
    }

    header .logo-box {
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      user-select:none;
      flex-wrap: wrap;
    }

    header img {
      height: 40px;
      filter: drop-shadow(0 0 6px rgba(212,175,55,0.35));
    }

    header h1 {
      margin: 0;
      font-family: "Playfair Display", serif;
      font-weight: 600;
      font-size: 22px;
      letter-spacing: 0.5px;
      color: var(--accent-gold);
    }

    .search-container input{
      width: 260px;
      max-width: 60vw;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06);
      color: var(--text-main);
      outline: none;
    }
    body.light-theme .search-container input{
      background: rgba(0,0,0,0.04);
      border: 1px solid rgba(0,0,0,0.12);
      color: var(--text-main);
    }

    nav {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--text-main);
      font-weight: 500;
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 10px;
      transition: background 0.2s, color 0.2s;
    }

    nav a:hover {
      background: var(--bg-glass);
      color: var(--accent-gold);
    }

    .theme-toggle {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 1px solid var(--border-glass);
      background: var(--bg-glass);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-hover);
      background: rgba(212,175,55,0.15);
      color: var(--accent-gold);
    }

    .hero {
      padding: 70px 20px 60px;
      text-align: center;
      background:
        radial-gradient(600px 300px at 50% -10%, rgba(212,175,55,0.18), transparent 70%),
        radial-gradient(800px 400px at 80% 0%, rgba(46,204,113,0.15), transparent 70%);
    }

    .hero h2 {
      font-family: "Playfair Display", serif;
      font-size: 40px;
      margin-bottom: 12px;
      letter-spacing: 0.5px;
      color: #ffffff;
    }

    body.light-theme .hero h2 { color: #1c1c1e; }

    .hero p {
      font-size: 17px;
      color: var(--text-muted);
      margin-bottom: 26px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .hero button {
      background: linear-gradient(135deg, #d4af37, #f1d67a);
      color: #0f1115;
      border: none;
      padding: 14px 28px;
      font-size: 15px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(212,175,55,0.35);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .hero button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(212,175,55,0.5);
    }

    .section {
      padding: 48px 20px;
      max-width: 1200px;
      margin: auto;
    }

    .section h3 {
      text-align: center;
      margin-bottom: 30px;
      font-family: "Playfair Display", serif;
      font-weight: 600;
      font-size: 28px;
      letter-spacing: 0.4px;
      color: var(--accent-gold);
    }

    .shops, .categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 18px;
    }

    .products {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .card, .product {
      background: linear-gradient(180deg, var(--bg-glass), rgba(255,255,255,0.02));
      border: 1px solid var(--border-glass);
      border-radius: var(--radius-xl);
      padding: 18px 16px;
      box-shadow: var(--shadow-soft);
      text-align: center;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .card:hover, .product:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      border-color: rgba(212,175,55,0.4);
    }

    .card img {
      max-width: 90px;
      max-height: 70px;
      object-fit: contain;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 8px rgba(212,175,55,0.25));
    }

    .card .icon {
      font-size: 38px;
      margin-bottom: 8px;
      display: block;
    }

    .card div {
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .product {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: left;
      gap: 14px;
      padding: 16px 18px;
    }

    .product img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 14px;
      background: rgba(255,255,255,0.1);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.15);
    }

    .product h4 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
    }

    .product p {
      margin: 6px 0 0;
      font-size: 14px;
      color: var(--text-muted);
    }

    .qty-controls {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      user-select:none;
    }

    .qty-controls button {
      width:32px;
      height:32px;
      border-radius:50%;
      border:none;
      background: linear-gradient(135deg, #2ecc71, #6df0a0);
      color:#0f1115;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 4px 14px rgba(46,204,113,0.35);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .qty-controls button:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 22px rgba(46,204,113,0.55);
    }

    .qty-number {
      min-width:24px;
      font-weight:600;
      text-align:center;
      color: var(--text-main);
    }

    .cart {
      background: linear-gradient(180deg, var(--bg-glass), rgba(255,255,255,0.02));
      border: 1px solid var(--border-glass);
      padding: 18px 16px;
      border-radius: var(--radius-xl);
      max-width: 540px;
      margin: 20px auto;
      box-shadow: var(--shadow-soft);
    }

    .cart h4 {
      margin-top:0;
      text-align:center;
      font-family: "Playfair Display", serif;
      font-weight: 600;
      font-size: 20px;
      color: var(--accent-gold);
      margin-bottom: 14px;
    }

    .cart-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
      font-size:14px;
      gap:10px;
      color: var(--text-main);
    }

    .cart-item span { color: var(--text-muted); }

    .cart-total {
      font-weight:600;
      margin-top:10px;
      text-align:center;
      color: var(--text-main);
    }

    .cart-item button {
      background: rgba(255,255,255,0.12) !important;
      border: 1px solid rgba(255,255,255,0.25);
      color: #ff6b6b;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      font-size: 12px;
      cursor: pointer;
      padding: 0;
      margin-left: auto;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    .cart-item button:hover {
      background: rgba(255,107,107,0.15) !important;
      transform: scale(1.05);
      box-shadow: 0 6px 14px rgba(255,107,107,0.35);
    }

    .order-form {
      background: linear-gradient(180deg, var(--bg-glass), rgba(255,255,255,0.02));
      border: 1px solid var(--border-glass);
      padding: 22px 20px;
      border-radius: var(--radius-xl);
      max-width: 540px;
      margin: auto;
      box-shadow: var(--shadow-soft);
    }

    .order-form input,
    .order-form textarea,
    .order-form select {
      width:100%;
      padding:12px 14px;
      margin-bottom:14px;
      border-radius:12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06);
      color: var(--text-main);
      font-size:14px;
      outline: none;
    }

    body.light-theme .order-form input,
    body.light-theme .order-form textarea,
    body.light-theme .order-form select {
      background: rgba(0,0,0,0.04);
      border: 1px solid rgba(0,0,0,0.12);
    }

    .order-form input::placeholder,
    .order-form textarea::placeholder {
      color: var(--text-muted);
    }

    .order-form button {
      width:100%;
      background: linear-gradient(135deg, #2ecc71, #6df0a0);
      color:#0f1115;
      border:none;
      padding:14px;
      font-size:16px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 8px 24px rgba(46,204,113,0.35);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .order-form button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(46,204,113,0.55);
    }

    footer {
      background: linear-gradient(180deg, rgba(15,17,21,0.9), rgba(15,17,21,1));
      color: var(--text-muted);
      text-align:center;
      padding:20px;
      margin-top:60px;
      font-size:13px;
      border-top: 1px solid var(--border-glass);
    }

    body.light-theme footer {
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,1));
    }

    .hidden { display:none; }

    .back-btn {
      display: inline-block;
      margin-bottom: 14px;
      background: var(--bg-glass);
      color: var(--text-main);
      border: 1px solid var(--border-glass);
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .floating-cart {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2ecc71, #6df0a0);
      color: #0f1115;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(46,204,113,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .floating-cart:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(46,204,113,0.7);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
      font-size: 16px;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .error-message {
      text-align: center;
      padding: 40px 20px;
      color: #ff6b6b;
      font-size: 16px;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .hero h2 { font-size: 32px; }
      .section h3 { font-size: 24px; }
      header h1 { font-size: 18px; }
      .floating-cart { bottom: 12px; right: 12px; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo-box" onclick="goHome()">
    <h1>Artik Food</h1>
  </div>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
  </div>
  <nav>
    <a href="#shops">–ú–∞–≥–∞–∑–∏–Ω—ã</a>
    <a href="#cart" onclick="event.preventDefault(); document.getElementById('cart-page').scrollIntoView({ behavior: 'smooth' });">–ö–æ—Ä–∑–∏–Ω–∞</a>
    <div class="theme-toggle" onclick="toggleTheme()">üåô</div>
  </nav>
</header>

<div id="home-page">
  <section class="hero">
    <h2>Premium –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –ê—Ä—Ç–∏–∫–µ</h2>
    <p>–ó–∞–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –ª—É—á—à–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –Ω–∞ –¥–æ–º</p>
    <button onclick="document.getElementById('shops').scrollIntoView({ behavior: 'smooth' });">
      –°–º–æ—Ç—Ä–µ—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã
    </button>
  </section>

  <section class="section" id="shops">
    <h3>–ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã</h3>
    <div class="loading" id="loading-shops">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤</div>
    <div class="shops" id="shops-list"></div>
  </section>
</div>

<div id="store-page" class="hidden">
  <section class="section">
    <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
    <h3 id="store-title"></h3>

    <div id="categories-block" class="hidden">
      <div class="categories" id="categories-list"></div>
    </div>

    <div class="products" id="store-products"></div>
  </section>

  <div id="store-cart" class="hidden">
    <div class="cart">
      <h4>–ö–æ—Ä–∑–∏–Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h4>
      <div id="store-cart-items"></div>
      <div class="cart-total" id="store-cart-total">–ò—Ç–æ–≥–æ: 0 AMD</div>
    </div>
  </div>
</div>

<section class="section" id="cart-page">
  <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
  <div class="cart">
    <div id="global-cart-items">
      <p style="text-align:center; color: var(--text-muted);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
    </div>
    <div class="cart-total" id="global-cart-total">–¢–æ–≤–∞—Ä—ã: 0 AMD</div>
    <div class="cart-total" id="delivery-total">–î–æ—Å—Ç–∞–≤–∫–∞: 0 AMD</div>
    <div class="cart-total" id="grand-total" style="font-size: 18px; color: var(--accent-gold);">–ò—Ç–æ–≥–æ: 0 AMD</div>
  </div>

  <div class="order-form">
    <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required>
    <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required>
    <select id="district">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω</option>
      <option value="–ê—Ä—Ç–∏–∫">–ê—Ä—Ç–∏–∫ (500 AMD)</option>
      <option value="–ê—Ä–∏—á">–ê—Ä–∏—á (700 AMD)</option>
      <option value="–ù–æ—Ä-–ö—è–Ω–∫">–ù–æ—Ä-–ö—è–Ω–∫ (1000 AMD)</option>
      <option value="–ü–µ–º–∑–∞—à–µ–Ω">–ü–µ–º–∑–∞—à–µ–Ω (1000 AMD)</option>
    </select>
    <select id="payment">
      <option value="–ù–∞–ª–∏—á–Ω—ã–µ">–ù–∞–ª–∏—á–Ω—ã–µ</option>
      <option value="–ö–∞—Ä—Ç–∞">–ö–∞—Ä—Ç–∞</option>
    </select>
    <textarea id="comment" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É"></textarea>
    <button onclick="sendFormToWhatsApp()">üì≤ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ WhatsApp</button>
  </div>
</section>

<div class="floating-cart" onclick="document.getElementById('cart-page').scrollIntoView({ behavior: 'smooth' });">
  üõí
</div>

<footer>
  <p>&copy; 2026 Artik Food. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</footer>

<script>
/* ---------------- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---------------- */
const STORES_CONTROL_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQKJ__WpYa8WaSisWWWT4N_NpURrENrWmM63WXkXGw0HrKalkhRQ6U6KZ3p_XLItgS-KYJvZ_TtXOjC/pub?output=csv";

/* ---------------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---------------- */
function jsSafe(str) {
  return String(str).replace(/\\/g, "\\\\").replace(/'/g, "\\'");
}

function decodeSafe(str) {
  return String(str).replace(/\\'/g, "'").replace(/\\\\/g, "\\");
}

function qtyId(storeKey, productName) {
  return `qty-${storeKey}-${jsSafe(productName)}`;
}

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Google Sheets —Å—Å—ã–ª–∫–∏ –≤ CSV export URL
function sheetToCSV(sheetUrl) {
  if (!sheetUrl || sheetUrl.trim() === '') return null;
  
  // –ò–∑–≤–ª–µ–∫–∞–µ–º ID —Ç–∞–±–ª–∏—Ü—ã –∏–∑ URL
  const match = sheetUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
  if (match && match[1]) {
    const sheetId = match[1];
    return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=0`;
  }
  return null;
}

// –ü–∞—Ä—Å–∏–Ω–≥ CSV
function parseCSV(text) {
  const lines = text.split('\n');
  const result = [];
  
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    
    const values = [];
    let currentValue = '';
    let inQuotes = false;
    
    for (let j = 0; j < line.length; j++) {
      const char = line[j];
      
      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) {
        values.push(currentValue.trim());
        currentValue = '';
      } else {
        currentValue += char;
      }
    }
    values.push(currentValue.trim());
    result.push(values);
  }
  
  return result;
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è
function createStoreKey(name) {
  return name
    .toLowerCase()
    .replace(/\s+/g, '_')
    .replace(/[^a-z0-9_–∞-—è—ë]/gi, '');
}

/* ---------------- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ò–ó GOOGLE SHEETS ---------------- */
let stores = {};
let storesOrder = [];

async function loadStoresFromGoogleSheets() {
  try {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤...');
    console.log('URL:', STORES_CONTROL_CSV_URL);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –º–∞–≥–∞–∑–∏–Ω–æ–≤
    const response = await fetch(STORES_CONTROL_CSV_URL);
    if (!response.ok) {
      throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã: ${response.status}`);
    }
    
    const csvText = await response.text();
    console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ, –ø–∞—Ä—Å–∏–Ω–≥...');
    const rows = parseCSV(csvText);
    console.log('–°—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ:', rows.length);
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
    const dataRows = rows.slice(1);
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
    dataRows.sort((a, b) => {
      const orderA = parseInt(a[0]) || 999;
      const orderB = parseInt(b[0]) || 999;
      return orderA - orderB;
    });
    
    console.log('–ú–∞–≥–∞–∑–∏–Ω–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:', dataRows.length);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
    for (const row of dataRows) {
      const [order, name, sheetUrl, status, logoUrl] = row;
      
      console.log(`–ú–∞–≥–∞–∑–∏–Ω: ${name}, –°—Ç–∞—Ç—É—Å: ${status}`);
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã
      if (status !== '–í–∫–ª—é—á–µ–Ω') {
        console.log(`  –ü—Ä–æ–ø—É—â–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${status})`);
        continue;
      }
      
      // –ï—Å–ª–∏ –Ω–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
      if (!sheetUrl || sheetUrl.trim() === '') {
        console.log(`  –ü—Ä–æ–ø—É—â–µ–Ω (–Ω–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É)`);
        continue;
      }
      
      const storeKey = createStoreKey(name);
      const csvUrl = sheetToCSV(sheetUrl);
      
      if (!csvUrl) {
        console.warn(`  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å CSV URL –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞: ${name}`);
        continue;
      }
      
      console.log(`  –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑: ${csvUrl}`);
      
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –º–∞–≥–∞–∑–∏–Ω–∞
        const storeResponse = await fetch(csvUrl);
        if (!storeResponse.ok) {
          console.error(`  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –º–∞–≥–∞–∑–∏–Ω–∞: ${storeResponse.status}`);
          continue;
        }
        
        const storeCSV = await storeResponse.text();
        const storeRows = parseCSV(storeCSV);
        
        console.log(`  –°—Ç—Ä–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤: ${storeRows.length}`);
        
        // –ü–∞—Ä—Å–∏–º —Ç–æ–≤–∞—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        const products = [];
        const categoriesSet = new Set();
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        for (let i = 1; i < storeRows.length; i++) {
          const [category, photo, productName, description, price] = storeRows[i];
          
          if (!productName || !price) continue;
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—É–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä)
          let cleanCategory = category ? category.replace(/^\d+\.\s*/, '').trim() : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
          categoriesSet.add(cleanCategory);
          
          // –ü–∞—Ä—Å–∏–º —Ü–µ–Ω—É (–±–µ—Ä—ë–º –ø–µ—Ä–≤—É—é –µ—Å–ª–∏ —á–µ—Ä–µ–∑ /)
          let cleanPrice = price.toString().split('/')[0].trim();
          cleanPrice = parseInt(cleanPrice.replace(/[^\d]/g, '')) || 0;
          
          products.push({
            name: productName.trim(),
            price: cleanPrice,
            category: cleanCategory,
            description: description ? description.trim() : '',
            photo: photo ? photo.trim() : ''
          });
        }
        
        console.log(`  –¢–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${products.length}`);
        console.log(`  –ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${categoriesSet.size}`);
        
        // –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
        const categories = {};
        const categoryIcons = {
          '–®–∞—É—Ä–º–∞': 'üåØ',
          '–®–∞—à–ª—ã–∫': 'üçñ',
          '–ú–∞–Ω–≥–∞–ª': 'üçñ',
          '–ö–µ–±–∞–±': 'ü•ô',
          '–ó–∞–∫—É—Å–∫–∏': 'üçü',
          '–§–∞—Å—Ç—Ñ—É–¥': 'üçî',
          '–°–æ—É—Å—ã': 'ü•´',
          '–ù–∞–ø–∏—Ç–∫–∏': 'ü•§',
          '–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã': '‚ùÑÔ∏è',
          '–¶–≤–µ—Ç—ã': 'üåπ',
          '–ë—É–∫–µ—Ç—ã': 'üíê',
          '–ö–æ–º–ø–æ–∑–∏—Ü–∏–∏': 'üå∫'
        };
        
        categoriesSet.forEach(cat => {
          // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –∏–∫–æ–Ω–∫—É
          let icon = 'üì¶';
          for (const [key, emoji] of Object.entries(categoryIcons)) {
            if (cat.toLowerCase().includes(key.toLowerCase())) {
              icon = emoji;
              break;
            }
          }
          categories[cat] = { icon };
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω –≤ stores
        stores[storeKey] = {
          name: name.trim(),
          logo: logoUrl ? logoUrl.trim() : '',
          categories: Object.keys(categories).length > 1 ? categories : null,
          products: products
        };
        
        storesOrder.push(storeKey);
        console.log(`  ‚úÖ –ú–∞–≥–∞–∑–∏–Ω ${name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`);
        
      } catch (error) {
        console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ ${name}:`, error);
      }
    }
    
    console.log('===================');
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
    console.log('–í—Å–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', Object.keys(stores).length);
    console.log('===================');
    
    // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω—ã
    document.getElementById('loading-shops').classList.add('hidden');
    
    if (Object.keys(stores).length === 0) {
      document.getElementById('loading-shops').classList.remove('hidden');
      document.getElementById('loading-shops').innerHTML = 
        '‚ö†Ô∏è –ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∏ –≤ –Ω–∏—Ö –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã.';
    } else {
      renderShops();
    }
    
  } catch (error) {
    console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:', error);
    document.getElementById('loading-shops').innerHTML = 
      `<div class="error-message">
        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö<br>
        <small>${error.message}</small><br><br>
        <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π</small>
      </div>`;
  }
}

/* ---------------- –°–û–°–¢–û–Ø–ù–ò–ï ---------------- */
let currentStore = null;
let currentCategory = null;
let carts = {};

/* ---------------- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---------------- */
function hideAllPages() {
  document.getElementById('home-page').classList.add('hidden');
  document.getElementById('store-page').classList.add('hidden');
}

function goHome() {
  hideAllPages();
  document.getElementById('home-page').classList.remove('hidden');
  document.getElementById('searchInput').value = '';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function goBack() {
  if (currentCategory) openStore(currentStore);
  else if (currentStore) goHome();
  else goHome();
}

/* ---------------- –ú–ê–ì–ê–ó–ò–ù–´ ---------------- */
function renderShops() {
  const container = document.getElementById('shops-list');
  container.innerHTML = '';

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º storesOrder –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
  const keysToRender = storesOrder.length > 0 ? storesOrder : Object.keys(stores);

  keysToRender.forEach(key => {
    if (!stores[key]) return;
    
    const div = document.createElement('div');
    div.className = 'card';

    if (stores[key].logo) {
      div.innerHTML = `
        <img src="${stores[key].logo}" alt="${stores[key].name}" onerror="this.style.display='none'">
        <div>${stores[key].name}</div>
      `;
    } else {
      div.innerHTML = `<div>${stores[key].name}</div>`;
    }

    div.onclick = () => openStore(key);
    container.appendChild(div);
  });
}

function openStore(storeKey) {
  currentStore = storeKey;
  currentCategory = null;

  hideAllPages();
  document.getElementById('store-page').classList.remove('hidden');

  document.getElementById('store-title').innerText = stores[storeKey].name;

  const container = document.getElementById('store-products');
  container.innerHTML = '';

  const backBtn = document.createElement('button');
  backBtn.className = 'back-btn';
  backBtn.innerText = '‚Üê –ù–∞–∑–∞–¥';
  backBtn.onclick = goHome;
  container.appendChild(backBtn);

  if (stores[storeKey].categories) {
    document.getElementById('categories-block').classList.remove('hidden');
    renderCategories(storeKey);
  } else {
    document.getElementById('categories-block').classList.add('hidden');
    renderProducts(storeKey);
  }
}

function renderCategories(storeKey) {
  const container = document.getElementById('categories-list');
  container.innerHTML = '';

  Object.keys(stores[storeKey].categories).forEach(catName => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <span class="icon">${stores[storeKey].categories[catName].icon}</span>
      <div>${catName}</div>
    `;
    div.onclick = () => openCategory(storeKey, catName);
    container.appendChild(div);
  });
}

function openCategory(storeKey, categoryName) {
  currentCategory = categoryName;
  document.getElementById('categories-block').classList.add('hidden');
  renderProducts(storeKey, categoryName);
}

function renderProducts(storeKey, filterCategory = null) {
  const container = document.getElementById('store-products');
  container.innerHTML = '';

  const backBtn = document.createElement('button');
  backBtn.className = 'back-btn';
  backBtn.innerText = '‚Üê –ù–∞–∑–∞–¥';
  backBtn.onclick = () => {
    if (filterCategory) {
      currentCategory = null;
      openStore(storeKey);
    } else {
      goHome();
    }
  };
  container.appendChild(backBtn);

  const products = filterCategory
    ? stores[storeKey].products.filter(p => p.category === filterCategory)
    : stores[storeKey].products;

  products.forEach(product => {
    const div = document.createElement('div');
    div.className = 'product';

    const safeName = jsSafe(product.name);

    div.innerHTML = `
      <div style="display:flex; gap:12px; align-items:center;">
        <img src="${product.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='60' height='60' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='30'%3Eüì¶%3C/text%3E%3C/svg%3E"}" alt="${product.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'60\\' height=\\'60\\'%3E%3Crect width=\\'60\\' height=\\'60\\' fill=\\'%23333\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' dominant-baseline=\\'middle\\' text-anchor=\\'middle\\' font-size=\\'30\\'%3Eüì¶%3C/text%3E%3C/svg%3E'">
        <div>
          <h4>${product.name}</h4>
          <p>${product.price} AMD</p>
          ${product.description ? `<p style="font-size:12px; color: var(--text-muted);">${product.description}</p>` : ''}
        </div>
      </div>
      <div class="qty-controls" onclick="event.stopPropagation()">
        <button onclick="changeQty('${storeKey}', '${safeName}', -1)" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
        <span class="qty-number" id="${qtyId(storeKey, product.name)}">0</span>
        <button onclick="changeQty('${storeKey}', '${safeName}', 1)" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
      </div>
    `;

    container.appendChild(div);

    // –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –µ—Å–ª–∏ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    const existing = carts?.[storeKey]?.[product.name] || 0;
    const el = document.getElementById(qtyId(storeKey, product.name));
    if (el) el.innerText = existing;
  });

  document.getElementById('store-cart').classList.remove('hidden');
  renderStoreCart(storeKey);
}

/* ---------------- –ö–û–†–ó–ò–ù–ê ---------------- */
function changeQty(storeKey, productNameSafe, delta) {
  const productName = decodeSafe(productNameSafe);

  if (!carts[storeKey]) carts[storeKey] = {};
  if (!carts[storeKey][productName]) carts[storeKey][productName] = 0;

  carts[storeKey][productName] += delta;
  if (carts[storeKey][productName] < 0) carts[storeKey][productName] = 0;

  const el = document.getElementById(qtyId(storeKey, productName));
  if (el) el.innerText = carts[storeKey][productName];

  renderStoreCart(storeKey);
  renderGlobalCart();
}

function renderStoreCart(storeKey) {
  const cartDiv = document.getElementById('store-cart-items');
  const totalDiv = document.getElementById('store-cart-total');
  cartDiv.innerHTML = '';

  let total = 0;

  if (carts[storeKey]) {
    Object.keys(carts[storeKey]).forEach(productName => {
      const qty = carts[storeKey][productName];
      if (qty > 0) {
        const product = stores[storeKey].products.find(p => p.name === productName);
        if (!product) return;
        const price = product.price * qty;
        total += price;

        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <div>${productName} √ó ${qty}</div>
          <span>${price} AMD</span>
          <button onclick="removeFromCart('${storeKey}', '${jsSafe(productName)}')" aria-label="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
        `;
        cartDiv.appendChild(item);
      }
    });
  }

  totalDiv.innerText = `–ò—Ç–æ–≥–æ: ${total} AMD`;
}

function removeFromCart(storeKey, productNameSafe) {
  const productName = decodeSafe(productNameSafe);

  if (carts[storeKey] && carts[storeKey][productName]) {
    carts[storeKey][productName] = 0;
    const qtyEl = document.getElementById(qtyId(storeKey, productName));
    if (qtyEl) qtyEl.innerText = 0;
    renderStoreCart(storeKey);
    renderGlobalCart();
  }
}

function renderGlobalCart() {
  const cartDiv = document.getElementById('global-cart-items');
  const totalDiv = document.getElementById('global-cart-total');
  const deliveryDiv = document.getElementById('delivery-total');
  const grandTotalDiv = document.getElementById('grand-total');
  cartDiv.innerHTML = '';

  let total = 0;
  let hasItems = false;

  Object.keys(carts).forEach(storeKey => {
    Object.keys(carts[storeKey]).forEach(productName => {
      const qty = carts[storeKey][productName];
      if (qty > 0) {
        hasItems = true;
        const product = stores[storeKey].products.find(p => p.name === productName);
        if (!product) return;
        const price = product.price * qty;
        total += price;

        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <div>
            ${productName} √ó ${qty}
            <div style="font-size:12px; color: var(--text-muted);">${stores[storeKey].name}</div>
          </div>
          <span>${price} AMD</span>
          <button onclick="removeFromCart('${storeKey}', '${jsSafe(productName)}')" aria-label="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
        `;
        cartDiv.appendChild(item);
      }
    });
  });

  if (!hasItems) {
    cartDiv.innerHTML = '<p style="text-align:center; color: var(--text-muted);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
  }

  totalDiv.innerText = `–¢–æ–≤–∞—Ä—ã: ${total} AMD`;

  const district = document.getElementById('district').value;
  let delivery = 0;
  if (district === "–ê—Ä—Ç–∏–∫") delivery = 500;
  else if (district === "–ê—Ä–∏—á") delivery = 700;
  else if (district === "–ù–æ—Ä-–ö—è–Ω–∫") delivery = 1000;
  else if (district === "–ü–µ–º–∑–∞—à–µ–Ω") delivery = 1000;

  deliveryDiv.innerText = `–î–æ—Å—Ç–∞–≤–∫–∞: ${delivery} AMD`;
  grandTotalDiv.innerText = `–ò—Ç–æ–≥–æ: ${total + delivery} AMD`;
}

/* ---------------- –ü–û–ò–°–ö ---------------- */
const searchInput = document.getElementById('searchInput');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase().trim();
  if (!query) { 
    if (currentStore) {
      openStore(currentStore);
    } else {
      goHome(); 
    }
    return; 
  }

  hideAllPages();
  document.getElementById('store-page').classList.remove('hidden');
  document.getElementById('store-title').innerText = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞';
  document.getElementById('categories-block').classList.add('hidden');

  const container = document.getElementById('store-products');
  container.innerHTML = '';

  const backBtn = document.createElement('button');
  backBtn.className = 'back-btn';
  backBtn.innerText = '‚Üê –ù–∞–∑–∞–¥';
  backBtn.onclick = () => {
    searchInput.value = '';
    goHome();
  };
  container.appendChild(backBtn);

  let foundCount = 0;

  Object.keys(stores).forEach(storeKey => {
    stores[storeKey].products.forEach(product => {
      if (product.name.toLowerCase().includes(query)) {
        foundCount++;
        const div = document.createElement('div');
        div.className = 'product';

        const safeName = jsSafe(product.name);

        div.innerHTML = `
          <div style="display:flex; gap:12px; align-items:center;">
            <img src="${product.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='60' height='60' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='30'%3Eüì¶%3C/text%3E%3C/svg%3E"}" alt="${product.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'60\\' height=\\'60\\'%3E%3Crect width=\\'60\\' height=\\'60\\' fill=\\'%23333\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' dominant-baseline=\\'middle\\' text-anchor=\\'middle\\' font-size=\\'30\\'%3Eüì¶%3C/text%3E%3C/svg%3E'">
            <div>
              <h4>${product.name}</h4>
              <p>${product.price} AMD</p>
              <p style="font-size:12px; color: var(--text-muted);">${stores[storeKey].name}</p>
            </div>
          </div>
          <div class="qty-controls" onclick="event.stopPropagation()">
            <button onclick="changeQty('${storeKey}', '${safeName}', -1)" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
            <span class="qty-number" id="${qtyId(storeKey, product.name)}">0</span>
            <button onclick="changeQty('${storeKey}', '${safeName}', 1)" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
          </div>
        `;
        container.appendChild(div);

        const existing = carts?.[storeKey]?.[product.name] || 0;
        const el = document.getElementById(qtyId(storeKey, product.name));
        if (el) el.innerText = existing;
      }
    });
  });

  if (foundCount === 0) {
    const noResults = document.createElement('p');
    noResults.style.cssText = 'text-align:center; color: var(--text-muted); margin-top: 40px;';
    noResults.innerText = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
    container.appendChild(noResults);
  }
});

/* ---------------- –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–û–°–¢–ê–í–ö–ò ---------------- */
document.getElementById('district').addEventListener('change', renderGlobalCart);

/* ---------------- TELEGRAM WORKER ---------------- */
const WORKER_URL = "https://artikfood-dispatcher.edulik844.workers.dev/orders";
const API_KEY = "artikfood_Secret_2026!";

async function sendOrderToWorker(payload) {
  try {
    const response = await fetch(WORKER_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": API_KEY
      },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) {
      console.error("Worker response error:", response.status);
    }
  } catch (e) {
    console.error("Worker error:", e);
  }
}

/* ---------------- WHATSAPP ---------------- */
function sendFormToWhatsApp() {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const address = document.getElementById('address').value;
  const district = document.getElementById('district').value;
  const payment = document.getElementById('payment').value;
  const comment = document.getElementById('comment').value;

  if (!name || !phone || !address || !district) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
    return;
  }

  let message = `üõí *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Äî Artik Food*%0A%0A`;
  message += `üë§ –ò–º—è: ${encodeURIComponent(name)}%0A`;
  message += `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${encodeURIComponent(phone)}%0A`;
  message += `üìç –ê–¥—Ä–µ—Å: ${encodeURIComponent(address)}%0A`;
  message += `üèò –†–∞–π–æ–Ω: ${encodeURIComponent(district)}%0A`;
  message += `üí≥ –û–ø–ª–∞—Ç–∞: ${encodeURIComponent(payment)}%0A`;
  if (comment) message += `üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${encodeURIComponent(comment)}%0A`;
  message += `%0Aüì¶ *–¢–æ–≤–∞—Ä—ã:*%0A`;

  let total = 0;
  let hasItems = false;

  Object.keys(carts).forEach(storeKey => {
    Object.keys(carts[storeKey]).forEach(productName => {
      const qty = carts[storeKey][productName];
      if (qty > 0) {
        hasItems = true;
        const product = stores[storeKey].products.find(p => p.name === productName);
        if (!product) return;
        const price = product.price * qty;
        total += price;
        message += `- ${encodeURIComponent(productName)} (${encodeURIComponent(stores[storeKey].name)}) √ó ${qty} = ${price} AMD%0A`;
      }
    });
  });

  if (!hasItems) {
    alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞! –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞.');
    return;
  }

  let delivery = 0;
  if (district === "–ê—Ä—Ç–∏–∫") delivery = 500;
  else if (district === "–ê—Ä–∏—á") delivery = 700;
  else if (district === "–ù–æ—Ä-–ö—è–Ω–∫") delivery = 1000;
  else if (district === "–ü–µ–º–∑–∞—à–µ–Ω") delivery = 1000;

  message += `%0Aüöö –î–æ—Å—Ç–∞–≤–∫–∞: ${delivery} AMD%0A`;
  message += `üí∞ *–ò—Ç–æ–≥–æ: ${total + delivery} AMD*`;

  const whatsappNumber = "37443797727";
  const url = `https://wa.me/${whatsappNumber}?text=${message}`;

  const itemsTotal = total;
  const grandTotal = total + delivery;

  sendOrderToWorker({
    createdAt: new Date().toISOString(),
    name, 
    phone, 
    address, 
    district, 
    payment, 
    comment,
    carts,
    totals: { itemsTotal, delivery, grandTotal }
  });

  window.open(url, "_blank");
}

/* ---------------- –¢–ï–ú–ê ---------------- */
function toggleTheme() {
  document.body.classList.toggle('light-theme');
  const icon = document.querySelector('.theme-toggle');
  if (document.body.classList.contains('light-theme')) {
    icon.innerText = '‚òÄÔ∏è';
  } else {
    icon.innerText = 'üåô';
  }
}

/* ---------------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---------------- */
loadStoresFromGoogleSheets();
renderGlobalCart();
</script>

</body>
</html>
