<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Artik Food — Доставка продуктов в Артике</title>
  <meta name="theme-color" content="#2ecc71">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAA1BMVEUAAACnej3aAAAASElEQVR4nO3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALwKcKAAAQyTtWAAAAAElFTkSuQmCC">
  <style>
    /* Стили остаются без изменений */
  </style>
</head>
<body>

<!-- Основная структура страницы остается без изменений -->

<script>
/* ---------------- ОСНОВНЫЕ ДАННЫЕ ---------------- */
const ADMIN_PASSWORD = "artik123";
let orders = JSON.parse(localStorage.getItem('artikFoodOrders')) || [];
let couriers = JSON.parse(localStorage.getItem('artikFoodCouriers')) || [];
let nextCourierId = couriers.length > 0 ? Math.max(...couriers.map(c => c.id)) + 1 : 1;

/* ---------------- УПРАВЛЕНИЕ КУРЬЕРАМИ ---------------- */

function addCourier() {
  const name = prompt("Имя курьера:");
  if (!name) return;
  
  const phone = prompt("Телефон курьера:");
  if (!phone) return;
  
  const courier = {
    id: nextCourierId++,
    name: name,
    phone: phone,
    status: 'active',
    completedOrders: 0,
    rating: 5.0
  };
  
  couriers.push(courier);
  localStorage.setItem('artikFoodCouriers', JSON.stringify(couriers));
  updateAdminStats();
  alert(`Курьер ${name} добавлен!`);
}

function toggleCourierStatus(courierId) {
  const courier = couriers.find(c => c.id === courierId);
  if (courier) {
    courier.status = courier.status === 'active' ? 'inactive' : 'active';
    localStorage.setItem('artikFoodCouriers', JSON.stringify(couriers));
    updateAdminStats();
  }
}

function assignCourier(orderId, courierId) {
  const order = orders.find(o => o.id === orderId);
  if (order) {
    order.courier = courierId;
    order.status = "Передан курьеру";
    localStorage.setItem('artikFoodOrders', JSON.stringify(orders));
    updateAdminStats();
  }
}

/* ---------------- АДМИН-ПАНЕЛЬ ---------------- */

function showAdminPanel() {
  document.getElementById('admin-panel').classList.remove('hidden');
  document.getElementById('admin-login-btn').style.display = 'none';
  updateAdminStats();
}

function hideAdminPanel() {
  document.getElementById('admin-panel').classList.add('hidden');
  document.getElementById('admin-login-btn').style.display = 'block';
}

function updateAdminStats() {
  const today = new Date().toDateString();
  const todayOrders = orders.filter(order => 
    new Date(order.date).toDateString() === today
  );
  
  document.getElementById('today-orders').textContent = todayOrders.length;
  document.getElementById('today-amount').textContent = 
    todayOrders.reduce((sum, order) => sum + order.total, 0);
  document.getElementById('active-couriers').textContent = 
    couriers.filter(c => c.status === 'active').length;
  
  renderOrdersList(orders);
  updateCouriersHistory();
}

function renderOrdersList(ordersList) {
  const container = document.getElementById('all-orders-list');
  container.innerHTML = '';
  
  ordersList.forEach(order => {
    const div = document.createElement('div');
    div.style.padding = '8px';
    div.style.borderBottom = '1px solid #eee';
    div.innerHTML = `
      <strong>${order.name}</strong> — ${order.total} AMD (${order.status})<br>
      <small>${order.address} • ${order.date}</small>
      ${order.status === "Новый" ? renderCourierAssign(order.id) : ""}
    `;
    container.appendChild(div);
  });
  
  if (ordersList.length === 0) {
    container.innerHTML = '<p style="text-align:center; color:#777;">Нет заказов</p>';
  }
}

function renderCourierAssign(orderId) {
  const activeCouriers = couriers.filter(c => c.status === 'active');
  let html = `<select id="courier-select-${orderId}">`;
  activeCouriers.forEach(c => {
    html += `<option value="${c.id}">${c.name} (${c.phone})</option>`;
  });
  html += `</select> 
            <button onclick="assignCourier(${orderId}, 
            document.getElementById('courier-select-${orderId}').value)">
            Назначить</button>`;
  return html;
}

function updateCouriersHistory() {
  const history = couriers.map(c => {
    const courierOrders = orders.filter(o => o.courier === c.id);
    return `
      <tr>
        <td>${c.name}</td>
        <td>${courierOrders.length}</td>
        <td>${courierOrders.length ? courierOrders[0].date : 'Нет'}</td>
      </tr>
    `;
  }).join('');
  document.getElementById('couriers-history').innerHTML = history;
}

function filterOrders() {
  const filter = document.getElementById('order-filter').value;
  const filtered = filter === "Все" ? orders : orders.filter(o => o.status === filter);
  renderOrdersList(filtered);
}

function exportToCSV() {
  const csv = orders.map(o => 
    `${o.id},${o.name},${o.total},${o.status}`
  ).join('
');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'orders.csv';
  a.click();
}

/* ---------------- ИНИЦИАЛИЗАЦИЯ ---------------- */

document.addEventListener('DOMContentLoaded', function() {
  const savedOrders = localStorage.getItem('artikFoodOrders');
  const savedCouriers = localStorage.getItem('artikFoodCouriers');
  
  if (savedOrders) orders = JSON.parse(savedOrders);
  if (savedCouriers) couriers = JSON.parse(savedCouriers);

  renderShops();
  renderGlobalCart();
});
</script>

</body>
</html>
